# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각
- 팀에서 사용하던 기술인거 같은데 이번기회에 조금 더 알아볼 수 있겠다!
- 근접성 서비스라는 하나의 서비스에 1장이라는 만큼의 설계가 들어가야 할까?

## 📝 2. 내용 정리
> 전체적으로 사업장에 대한 수정이나 삭제는 많이 일어나지 않기때문에 읽기에 초점을 맞춘 설계라고 읽혔다. 주요 내용은 근접성 서비스의 알고리즘 이라고 생각한다.

### 주변 사업장 검색 알고리즘
- 방안1 : 2차원 검색
    - 단순한 구조의 2차원 구조로 원안에 놓은 사업장을 검색하는 방법이다. 가장 직관적이지만, 지나치게 단순하다는 치명적인 단점이 존재한다. 테이블 전부를 읽어야 하므로 실제 서비스에서는 효율적이지 못하다.

- 방안2 : 균등 격자
    - 작은 격자 또는 구획으로 나누는 단순한 접근법이다. 하지만 사업장의 분포가 균등하지 않다는 문제점이 존재한다. 인구가 많은 곳은 격자를 크게, 인구가 적은 곳은 격자를 작게 설정하는게 가장 효율적이다.

- 방안3 : 지오해시
    - 균등 격자보다 나은 방안이다. 2차원의 위도 경도 데이터를 1차원의 문자열로 반환한다.
```
위도 범위 [-90, 0]은 0에 대응
위도 범위 [0, 90]은 1에 대응
경도 범위 [-180, 0]은 0에 대응
경도 범위 [0, 180]은 1에 대응
```
해당 규칙을 이용해 계속해서 재귀적으로 나누어 원하는 정밀도를 얻을 때까지 나눌 수 있다. 이 알고리즘도 격자 가장자리 이슈가 발생할 수 있다.

- 방안4 : 쿼드트리
    - 쿼드트리는 격자의 내용을 특정 기준을 만족할 때까지 2차원 공간을 재귀적으로 사분면 분할하는데 흔히 사용되는 자료구조이다. 메모리를 많이 잡아먹지는 않지만 트래픽을 고려해 여러 대 서버로 분산시켜야 할 것이다.
    - 실제 쿼드트리를 사용하는 사례는 인구 밀집 지역에는 작은 격자를, 그렇지 않은 지역에는 큰 격자를 사용하고 있다.

- 방안5 : 구글 S2
    - 지구를 힐베르트 곡선이라는 공간 채움 곡선을 사용해 1차원 색인화 하는 방안이다.

### 추천 방법
1. 지오해시 : 빙 지도, 레디스, 몽고DB, 리프트
2. 쿼드트리 : 엑스트
3. 지오해시 + 쿼드트리 : 엘라스틱서치
4. S2 : 구글 맵, 틴더
위와같은 회사들이 해당 알고리즘을 사용하고 있다.

면접시에는 **지오해시**나 **쿼드트리** 가운데 하나를 선택하길 추천한다.

### 상세 설계
**사업장 테이블과 지리정보 색인 테이블**
> 사업장 테이블은 샤딩을 적용하기 좋은 후보이다. 지리정보 색인 방법은 지오해시를 사용한다고 가정했을때, 테이블 구성방법은 두가지다.

1. JSON 배열로 만들어 같은 열에 저장하는 방안
2. 각각 별도 열로 저장하는 방안 -> `추천방법`

**캐시 키**
> 캐시 계층을 도입하기 위해 정말 필요한가? 를 생각해보아야한다. 여기서 사용하기 가장 좋은 캐시는 사용자 위치의 위도 경도 정보이다.

하지만 사용자 위치 정보는 캐시 키로는 적절하지 않다.


## 💡 3. 전부 읽고 난 후기
- 하나의 서비스를 이렇게 구체적으로 분석하고 설계하는게 내가 가장 필요로 해야하는 공부라고 생각했다.
- 근접성 서비스에서 사용되는 알고리즘에 대해 조금이나마 알 수 있었다.

## ❓ 4. 특별히 궁금했던 부분
- 구글 S2 알고리즘에 대해 조금 더 구체적으로 알고 싶어졌다.
