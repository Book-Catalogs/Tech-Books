# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각
- 주변 친구? 1장과 비슷하게 근접성 서비스와 비슷한 내용인가?

## 📝 2. 내용 정리
> 1장과 비슷하지만 1장에선 사업장이 고정 위치에 있었다면 주변 친구의 경우 움직이는 사용자들사이의 위치 정보 시스템이다.

### P2P와 백엔드
- P2P방식으로 해결이 가능한 문제이지만 모바일 단말은 통신 연결 상태가 좋지 않은 경우도 있고 사용할 수 있는 전력도 충분하지 않아 비효율적이다. 때문에 공용 백엔드를 사용하는 것이 효율적이다.

**백엔드의 역할**
1. 모든 활성 상태 사용자의 위치 변화 내역을 수신
2. 사용자 위치 변경 내역을 수신할 떄마다 사용자의 모든 활성 친구를 찾아 친구들의 단말에 변경 내역 전달
3. 두 사용자 거리가 임계치보다 멀면 수신하지 않음

-> 엄청난 양의 갱신 내역을 사용자 단말로 보내야하기때문에 설계를 잘해야한다.

### 웹소켓 서버
- 양방향 통신을 이용해 실시간성을 극대화하는 방법이다.

### 레디스 Pub/Sub
- 특정 사용자의 위치 변경 이벤트는 해당 사용자의 펍/섭 채널에 발행되며, 친구들의 웹소켓 연결 핸들러가 이를 구독한다. 친구가 활성 상태면 거리 계산 후, 검색 반경 내일 경우 갱신된 위치와 시각을 클라이언트로 전송한다. 경량 메시지 버스도 유사 방식으로 활용 가능하다.

### 데이터베이스를 사용하지 않는 이유
- 레디스는 읽기 및 쓰기 연산 속도가 엄청나게 빠르다. TTL을 지원하므로 더 이상 활성 상태가 아닌 데이터도 자동으로 제거할 수 있다.
- 주변 친구 기능이 활용하는 위치 정보에 대해서는 영속성을 보장할 필요가 없다. 

### 상세 설계
**웹소켓 서버**
> 웹소켓 클러스터는 사용률에 따라 규모를 자동으로 늘리는 것은 그다지 어렵지 않다.


**사용자 데이터베이스**
> 사용자와 친구 관계 데이터를 저장할 수 있어야한다. 

**레디스 Pub/Sub 서버**
> 레디스 Pub/Sub을 사용하는 이유는 채널을 만드는 비용이 아주 저렴하기 때문이다. 그리고 구독자가 없는 채널로 전송된 메시지는 그대로 버려지고 서버에 가해지는 부하가 없다.


## 💡 3. 전부 읽고 난 후기
- 움직이는 사용자 간 실시간 위치 기반 서비스를 효율적으로 설계하기 위한 다양한 기술적 선택지가 인상적이었다. 특히 레디스 Pub/Sub의 활용이 효율적이라는 점이 돋보엿따.
- P2P 방식의 한계를 보완하고 백엔드를 통해 대규모 실시간 처리를 구현하는 방안을 배울 수 있었다.

## ❓ 4. 특별히 궁금했던 부분
- Redis Pub/Sub 대신 Kafka나 RabbitMQ 같은 대체 기술을 사용하면 어떤 차이가 생길까?
- 실시간 위치 정보 시스템에서 보안과 프라이버시 문제는 생각하지 않는다고 했지만, 상세히 다룬 사례가 궁금하다.
