# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각

- 생각보다는 간단하게 구현이 가능 할 것 같은데, 어떤 내용을 포함하고 있는 지 궁금하다.

## 📝 2. 내용 정리

메시지 큐의 필요성 여부

- 게임 점수가 어떻게 사용되는지에 따라 다름
  - 여러 기능에 사용이 되는 경우 : 메세지 큐를 사용하는 것이 합리적일 수 있음
  - 단일 기능에 사용되는 경우 : 꼭 필요한 선택지는 아니다

데이터 모델

- RDS
  - 규모 확장성이 그다지 중요하지않고, 사용자가 많지 않은 경우 유용
  - record 가 많아질 수록 성능이 급격히 안좋아지는 단점 존재
    - 지속적으로 변화하는 대량의 정보를 신속하게 처리하지 못함
- Redis
  - 메모리 기반이기에 빠른 읽기 및 쓰기가 가능함
  - 정렬 집합 이라는 자료형을 제공
    - 내부적으로 해시테이블과 스킵리스트라는 두가지 자료 구조를 사용
      - 해시테이블 : 사용자의 점수를 저장
      - 스킵리스트 : 특정 점수를 딴 사용자들의 목록을 저장
    - 색인을 두어, 이진 검색 알고리즘 처럼 보다 효율적인 탐색을 할 수 있도록 해줌.
- NoSQL
  - 이상적인 요구사항
    - 쓰기 연산에 최적화 되어 있음
    - 같은 파티션 내의 항복을 점수에 따라 효율적으로 정렬가능 
  - 확장성을 위한 설계
    - Game_name#{year-month}를 파티션 키, 게임 점수를 정렬 키로 사용
      - 해당 방식의 경우 부하가 높을 때 문제가 생김
    - 데이터를 n개 파티션으로 분할하고 파티션 번호(user_id % partition_number)로 사용 

Redis 연산

- ZADD : 기존에 없던 사용자를 집합에 삽입
- ZINCRBY : 사용자 점수를 지정된 값 만큼 증가
- ZRANGE / ZREVRANGE : 점수에 따라 정렬된 사용자 중 특정 범위에 드는 사용자를 가져옴
- ZRANK / ZREVRANK : 오름차순/내림차순 정렬했을 때 특정 사용자의 위치를 가져옴

클라우드 서비스 사용 여부

- 자체 서비스를 이용하는 방안
  - 서버에서 Redis, MySQL에 query를 하여 정보 들고 오는 방식
- 클라우드 서비스를 이용하는 방안
  - AWS API Gateway + AWS Lambda를 사용하는 방식

레디스 규모 확장

- DAU가 늘어나는 경우 저장용량이 65GB 정도, QPS 250,000 정도 됨

- 샤딩을 통해 문제 해결
  - 고정파티션
    - 순위표에 등장하는 점수의 범위에 따라 파티션을 나누는 방안
    - 순위표 전반에 점수가 고르게 되도록 범위를 잘 나누어 줘야 함
  - 해시파티션
    - 레디스 클러스터를 사용하는 방식
    - 사용자들의 점수가 특정 대역에 과독하게 모여 있는 경우에 효과적

## 💡 3. 전부 읽고 난 후기

- 간단하게 설계할 수 있지 않을까 했던 영역의 경우 DAU가 낮은 상황만을 고려해서 그랬었다.
- 실제로는 고민을 많이 해야하는 영역임을 알게됨

## ❓ 4. 특별히 궁금했던 부분

- dynamoDB에서 기본키랑 파티션 키는 어떻게 다른것인가?
  - 기본 키
    - 테이블의 각 항목을 유일하게 식별
    - 파티션 키 혹은 파티션키 + 정렬키로 구성됨
    - 항목을 식별하는 역할을 함
  - 파티션 키 
    - 데이터를 어떤 파티션에 저장할 지 결정
    - 기본키의 일부이다
    - 데이터를 분산 저장하는 기준을 해주는 역할을 함