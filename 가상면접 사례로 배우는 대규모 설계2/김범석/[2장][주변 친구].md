# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각

- 1장과 관련이 있지만 뭔가 조금 더 조건이 추가 된 설계안 일 것 같다.

## 📝 2. 내용 정리

#### P2P vs 공용 백엔드

P2P

중앙 서버에 의존하지 않고 네트워크에 연결된 각 노드가 서로 직접 데이터를 공유하거나 통신하는 방식

=> 통신 연결 상태가 좋지 않은 경우 혹은 사용 가능한 전력이 충분치 않아서 실용적인 아이디어 X

공용 백엔드

백엔드 서버가 메세지 전송과 관련해 역할을 담당 

- 활성 상태 사용자의 위치 변화 내역 수신
- 위치 변경 내역 수신 시, 모든 활성 상태 친구를 찾아 변경 내역을 전달
- 두 사용자 사이의 거리가 먼 경우 변경 내역 전송 X

#### 위치 정보 저장 

DB 보단 Redis와 같은 저장소에 저장하는 것이 적합

- 위치 정보의 경우 **현재 위치** 정보만을 필요로 함
- 현재 위치 정보의 경우 영속성을 보장할 필요가 없고, TTL으로 활성 상태가 아닌 경우 자동으로 삭제가능

#### 분산 레디스 pub/sub 서버 클러스터

레디스 서버 -> 채널간 서로 독립적 => 메시지를 발행할 사용자 ID를 기준으로 pub / sub 서버 샤딩 진행.

클러스터링 시 pub / sub 서버는 메시지를 발행 혹은 구독하는 채널을 정해야 할 때, hash ring을 참조

#### 친구가 많은 사용자

친구가 많은 사용자가 있는 pub / sub 채널의 경우 부하가 다수 걸릴 수 있음

하지만 여러 채널의 pub / sub 채널에 분산되는 점을 생각한다면 큰 부하점은 아님

#### 주변의 임의 사용자

지오해시로 격자를 나누고, 사용자가 존재하는 지역의 지오해시에 구독을 함.

만약 경계 부근의 사용자에 대해 잘 처리하고자 한다면, 주변 격자들 구독하는 방식으로 진행

## 💡 3. 전부 읽고 난 후기

- ws의 경우 보통 실시간 채팅만 생각을 했었는데, 다른 방법으로도 쓰일 수 있다는 것을 깨달음.

## ❓ 4. 특별히 궁금했던 부분

- `기존 레디스 펍/섭 서버를 새 서버로 교체할 때 운영 문제가 발생할 가능성은 클러스터 크기를 조정할 때 보다 훨씬 낮다`