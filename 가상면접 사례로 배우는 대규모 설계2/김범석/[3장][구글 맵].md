# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각

- 구글맵에 관련한 지도 내용인 것 같음. 과연 구글에서는 어떻게 지도를 설계해 두었을까?

## 📝 2. 내용 정리

측위 시스템 - 구 표면 상의 위치를 표현하는 체계를 말함. (북극이 최 상단, 남극이 최 하단)

지도 표시 

지도를 표시할 때에는 하나의 이미지가 아닌 관계된 영역에 대해 타일 단위로 보여줌.

계층적 경로 안내 타일 

보통의 경우 구체성 정도를 상, 중, 하로 구분해 세가지 경로 안내 타일을 준비함.

#### 상세 설계

경로 안내 

- 그래프 데이터는 메모리에 인접리스트 형태로 보관하는 것이 일반적
  - 하지만 그렇게 하기에는 양이 너무 많은 방식
  - 그래프의 노드와 선을 레코드로 저장하는 것도 방법이지만 역시 비용이 많이 들음
- S3같은 저장소에 파일을 보관하고, 그 파일을 이용할 경로 안내 서비스에서 적극적으로 캐싱하는 방식으로 진행

사용자 위치 데이터

- 사용자의 위치정보는 도로 데이터, 경ㄹ로 안내 타일 갱신 및 유용하게 사용하는 데이터
- 사용자 위치 데이터를 저장하기 위해서는 엄청난 양의 쓰기 연산을 잘 처리해야 하고, 수평적 규모 확장이 가능한 DB가 필요.

위치 서비스

- 사용자 위치 데이터 저장에는 key - value 저장소를 활용
- 사용자 위치의 경우 계속 변화하며, 변경되고 나면 이전 정보는 바로 무용해 지기 때문에 **일관성** 보다는 **가용성**이 중요함
- 이러한 요구사항을 맞출 수 있는 DB로 카산드라 추천

사용자 위치 데이터 

- 새로 개설되거나 폐쇄된 도로 감지 및 데이터의 정확성을 개선하는 용으로도 사용이 가능함
- 사용자 위치 데이터의 경우 다양하게 사용할 수 있는 data 
- DB 저장 외에 별도로 카프카 메세지 발행을 통해 각자 서비스에서 맞는 용도로 후처리 시스템 처리

지오코딩 서비스 

- 주소를 위도와 경도 쌍으로 바꿔주는 서비스.
  - 다만, 주소 표현 방식은 다양할 수 있음을 고려 해야 함 

최단 경로 서비스 

- 출발지 목적지의 위/경도를 받아 k개 최단 경로를 반환하는 서비스 
  - 교통이나 도로 상황은 고려하지 않고, 오로지 도로 구조에만 의존해 계산을 수행 
  - 도로망 그래프의 경우 정적이므로 캐시해 두는 것이 좋음 
- 최단 경로 서비스의 개요
  - 입력으로 출발지와 목적지의 위/경도를 받음
  - 이 위치 정보를 지오해시로 변환한 다음 출발지와 목적지 경로 안내 타일을 받음
  - 출발지 타일에서 시작해 그래프 자료 구조를 탐색해 나감
  - 탐색 범위를 넓히는 과정에서 필요한 주변 타일은 객체 저장소 혹은 캐시에서 가져옴

예상 도착 시간 서비스 

- 최단 경로 목록을 수신하면 예상 도착 시간 서비스를 호출해 경로에 대한 각각의 소요 시간을 추정
- 기계 학습을 통해 현재 교통 상황 및 과거 이력에 근건해 도착 시간을 계산



## 💡 3. 전부 읽고 난 후기

- 글로나마 구글맵 아키텍처를 설계해 볼 수 있어 좋은 기회 였던 것 같음
- 현재까지는 DB관련해서 RDB만 생각해왔었는데, 경우에 따라 효율적인 DB를 채택해야하는 필요성에 대해 느끼는 중

## ❓ 4. 특별히 궁금했던 부분

- 높은 가용성, 막대한 규모 연산을 보장해야하는 경우 카산드라를 추천하는데 왜 그런지 ?
  - 가용성
    - Peer to Peer 아키텍처
      - 카산드라의 클러스터 내 모든 노드는 동등한 역할을 함. -> 단일 실패 지점이 없음
    - 데이터 복제
      - 데이터를 자동으로 여러 노드에 복제해 가용성을 보장함
    - CAP 이론에서 가용성과 일관성을 조정할 수 있는 기능을 제공함
  - 막대한 규모 연산
    - 분산 데이터 저장
      - Consistent Hashing 방식을 통해 여러 노드에 고르게 분산
        - 한 노드가 아닌 클러스터 전체 자원을 활용해 데이터 처리
    - 쓰기 최적화
      - LSM(Log-Structured Merge) 트리 기반으로 설게된 데이터 저장 방식
      - 데이터는 디스크에 쓰기 전에 메모리 구조에 기록되고, 일정 시간이 지나면 일괄적으로 디스크에 병합
  - 확장성
    - 수평 확장 기반 설계
      - 노드를 클러스터에 추가하면 데이터는 자동으로 분산되고, 클러스터의 전체 처리성능이 증가
    - Consistent Hashing 기반 데이터 분배
      - 데이터 저장 시 **파티션 키**를 기반으로 분산 저장
        - 새로운 노드가 추가 혹은 제거되면, 데이터를 효율적으로 재배치