# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각

- 프로메테우스 그라파나 이런 내용을 다루는 것인가?

## 📝 2. 내용 정리

데이터 모델

- 지표 데이터는 통상 시계열 데이터 형태로 기록

데이터 접근 패턴

- 해당 시스템에 대한 쓰기 부하는 막대함
- 반면 읽기 부하는 치솟았다 사라지는 경향을 보임

데이터 저장소 시스템

- 저장소 시스템을 직접 설계 혹은 MySQL 같은 범용 저장소 추천 X
  - 범용 DB : 시계열 데이터를 처리할 수 있지만 전문가 수준의 튜닝이 필요함
- 시계열 데이터 저장에 최적화 된 저장소를 사용하는 것이 낫다. => InfluxDB, Prometheus

#### 상세 설계

**지표 수집**

푸시 모델 vs 풀 모델

 풀 모델 

- 데이터를 가져올 서비스 목록을 저장할 수 있는 저장소가 필요
  - 모든 서비스 엔드포인트의 DNS/IP 정보 지니면 좋음 -> 하지만 서버가 수시로 변경되기 때문에 best solution은 아님
  - etcd나, 아파치 주키퍼 같은 서비스 탐색 기술을 활용하면 해당 문제 해결 가능 
    - 각 서비스는 자신의 가용성 정보를 서비스 탐색 서비스에 기록하고, 엔드포인트 목록에 변화가 생길 때 통보
- 단일 지표 수집기로는 가용성이 어려울 수 있음 -> 여러대의 지표 수집기를 배치해야 함
  - 주의점 : 여러 서버가 같은 출처에서 데이터를 중복해서 가져올 가능성이 있음 
  - 중재 메커니즘 : 안전 해시 링을 사용
    - 해시 링 구간마다 해당 구간에 속한 서버로부터 지표의 수집을 담당하는 수집기 서버를 지정

푸시 모델 

- 모니터링 대상 서버에 수집 에이전트 소프트웨어를 설치 
- 데이터 집계 : 수집기에 보내는 데이터의 양을 줄이는 방법 
  - 에이전트 내부의 소규모 버퍼에 일시적으로 보관한 다음 전송하는 방식

질의 서비스

질의 서비스를 두면 곤란한 경우

- 상용화 시각화 및 경보 시스템을 사용하는 경우 

저장소

- 시계열 데이터베이스는 신중하게 선택할 것 
  - 운영 데이터 저장소에 대한 질의의 85%는 대부분 지난 26시간 정도
- 저장 용량 최적화
  - 데이터 인코딩 및 압축
    - 데이터를 완전한 형태로 저장하는 것이 아닌 diff 값을 통해서 저장하는 방식
      - ex) 1610087371, 10, 10, 9, 11
  - 다운 샘플링
    - 데이터 해상도를 낮춰 저장소 요구량을 줄이는 기법
      - 7일 이내 : 샘플링을 적용하지 않음
      - 30일 이내 : 1분 해상도로 낮춰 보관
      - 1년 이내 : 1시간 해상도로 낮춰 보관
  - 냉동 저장고
    - 잘 사용되지 않는 비활성 상태 데이터를 보관하는 방식

## 💡 3. 전부 읽고 난 후기

- 

## ❓ 4. 특별히 궁금했던 부분

- 잘 사용되지 않는 비활성 상태 데이터는 왜 저장을 해야하는 가? 그에 대한 적절한 주기는?