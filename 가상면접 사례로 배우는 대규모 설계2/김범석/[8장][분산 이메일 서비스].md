# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각

- 스팸메일 이런 분류 처리는 어떻게 하는 지 궁금하다

## 📝 2. 내용 정리

이메일 프로토콜

- SMTP (Simple Mail Transfer Protocol )
  - 이메일을 한 서버에서 다른 서버로 보내는 표준 프로토콜
- POP(Post Office Protocol)
  - 이메일 클라이언트가 원경 메일 서버에서 이메일을 수신하고 다운로드하기 위해 사용되는 표준 프로토콜
  - 단말로 다운로드 된 이메일은 서버에서 삭제
- IMAP(Internet Mail Access Protocol )
  - 클릭하지 않으면 이메일이 다운로드되지 않으며, 메일 서버에서도 지워지지 않음
- HTTPS
  - 기술적으론 엄연한 메일 전송 프로토콜은 아님
  - 웹기반 이메일 시스템의 메일함 접속에 사용 가능



상세 설계

메타데이터 DB

이메일 메타데이터의 특성 

- 헤더는 일반적으로 작고, 빈번하게 사용됨
- 이메일 본문의 크기는 작은 것 부터 큰 것 까지 다양하지만 사용 빈도는 낮음.(일반적으로 한번만 읽음)
- 이메일 가져오기, 읽은 메일로 표시, 검색 등의 이메일 관련 작업은 사용자별로 격리 수행되어야 함
- 데이터의 신선도는 데이터 사용 패턴에 영향을 미침 (보통 최근 메일만 읽음)
- 데이터의 높은 안정성이 보장 되어야 함

올바른 DB 선정

- 관계형 DB
  - 이메일을 효율적으로 검색 할 수 있음
  - 이메일 헤더와 본문에 대한 인덱스를 만들어두면 query는 빠리게 처리 할 수 있음
  - 데이터의 양이 적을 때 적합
- 분산 객체 저장소 
  - 객체 저장소는 백업 데이터를 보관하기에는 좋지만, 이메일의 부가 기능을 구현하기에 적합하지 않음
- NoSQL
  - 구글의 경우 자체적인 BigTable을 사용

검색

- 엘라스틱 서치
  - 동기식 호출 : 검색
  - 비동기식 호출 : 이메일 전송 / 수신 /삭제
  - 비동기식 호출의 경우 카프카를 활용해 결합도를 낮추는 방식을 택할 수 있음
- 맞춤형 검색 솔루션
  - LSM(Long Structured Merge) 트리를 사용해 디스크에 저장되는 색인을 구조화 하는 방식
    - 새로운 메일이 도착 할 경우 우선적으로 메모리 캐시로 구현되는 계층에 데이터 추가

## 💡 3. 전부 읽고 난 후기

- 매번 너무 당연하게 생각하고 사용해 오던 이메일 서비스에 대해 설계를 해보니 실제로 생각보다 많은 부분들을 고려해야 함을 깨달음

## ❓ 4. 특별히 궁금했던 부분

- 만약 이메일을 보내는 과정에서 담당 서버가 죽었을 때에는 어떻게 보완을 해줄 수 있을지?