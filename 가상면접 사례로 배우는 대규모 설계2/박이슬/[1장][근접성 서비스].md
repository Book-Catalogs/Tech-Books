## 📖 1. 목차를 읽기 전에 든 생각
- 근접성 서비스가 뭐지? 내 주위의 특정 가게들을 찾는 서비스인가?
- 내 주위 몇 미터 반경의 위치를 좌표(위도, 경도)를 통해서 찾을 수 있을 것 같다.
- DB로 MySQL을 사용한다면 MySQL의 공간 인덱스를 활용할 수 있지 않을까?
- 근접성 서비스는 어떻게 설계하는걸까? 궁금하다.

## 📝 2. 내용 정리
- 근정섭 서비스는 가까운 시설을 찾는 서비스이며, 가까운 k개 주유소 검색 등에 이용된다.
- 1단계: 문제 이해 및 설계 범위 확정 -> 면접관과의 대화를 통해 기능/비기능 요구사항을 추출하고, 시스템의 규모를 설정한다.
- 2단계: 개략적 설계안 제시 및 동의 구하기
    - 주변 사엄장 검색 알고리즘
        - 방안 1: 2차원 검색 -> 주어진 반경으로 그린 원 안에 놓인 사업장을 검색하는 방법이다. SQL문은 테이블 전부 읽어야 하므로 데이터의 양 때문에 효율적일 수 없다. 인덱스를 사용해도 오직 한 차원의 검색 속도만 개선된다. 그렇다면 2차원 데이터를 한 차원에 대응시켜보자.
        - 방안 2: 균등 격자 -> 작은 격자로 나누는 단순한 접근법이다. 사업장 분포가 균등하지 않는 단점이 있다.
        - 방안 3: 지오해시 -> 비트를 하나씩 늘려가며 재귀적으로 더 작은 격자로 분할하는 방법이다. 격자 가장자리 이슈가 있다.
            - 격자 가장자리 이슈 1 -> 아주 가까운 두 위치가 어떤 공통 접두어도 갖지 않는 일이 발생할 수 있다.
            - 격자 가장자리 이슈 2 -> 두 지점이 공통 접두어 길이는 길지만 서로 다른 격자에 놓이는 경우가 있다.
        - 방안 4: 쿼드트리 -> 격자가 특정 기준을 만족할 때까지 2차원 공간을 재귀적으로 사분면 분할하는 자료구조이다. 트리를 LBS 서버 메모리에 저장한다.
            - 쿼드트리 인덱스가 메모리를 많이 잡아먹지 않으므로 서버 한 대에 충분히 올릴 수 있지만, 트래픽을 고려해야 한다.
            - 블루/그린 배포와 같이 테스트 환경의 모든 서버에 동시 배포하면 DB를 동시에 읽어 큰 부하가 가해질 수 있다는 점을 유의하자.
        - 방안 5: 구글 S2
            - 쿼드트리와 마찬가지로 메모리 기반이다. 지구를 힐베르트 곡선이라는 공간 채움 곡선을 사용하여 1차원 색인화하는 방법이다.
- 3단계: 상세 설계
    - 데이터베이스의 규모 확장성
        - 사업장 테이블은 사업장 ID를 기준으로 샤딩하면 부하 분산이나 운영 관리가 쉽다.
        - 지리 정보 색인 테이블은 지오해시에 속한 사업장 ID를 각각 별도 열로 저장하는 것을 추천한다.
    - 캐시
        - 캐시 도입 전 정말 필요한가? 를 생각해보자.
        - 키:값으로 <지오해시: 해당 격자 내의 사업장 ID 목록>, <사업장 ID: 사업장 정보 객체>를 보관하면 성능 향상시킬 수 있다.
    - 지역 및 가용성 구역
        - 위치 기반 서비스는 여러 지역과 가용성 구역에 설치하면 여러 장점이 있다.
    - 추가 질문: 시간대 혹은 사업장 유형별 검색
        - 지오해시나 쿼드트리를 통해 얻어지는 검색 결과는 상대적으로 적으므로, 일단 근처 사업장 ID부터 전보 확보한 다음 필터링하면 된다.

## 💡 3. 전부 읽고 난 후기
- 문제를 이해하고 설계 범위를 좁히기 위해서 초반에 면접관과의 대화가 가장 중요한 것 같다.
- 지오해시나 쿼드트리 알고리즘를 알게 되었고, 두 알고리즘이 어떤 부분에서 구별되는지 알 수 있어 좋았다.
- 배포 방법까지 고민하고, 어떤 대상을 캐시해야 효율적인지 고민하는 부분이 좋았다.

## ❓ 4. 특별히 궁금했던 부분
- 읽기 연산이 압도적인 시스템에는 MySQL 같은 관계형 DB가 바람직할 수 있다고 하는데, 왜 그런지?
- 각 회사의 배포 방법이 궁금하다.
