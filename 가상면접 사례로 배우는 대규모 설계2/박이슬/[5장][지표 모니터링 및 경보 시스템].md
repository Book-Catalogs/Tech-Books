## 📖 1. 목차를 읽기 전에 든 생각
- 그라파나랑 핀포인트가 떠오른다.
- 에러 발생 시 빠른 대처를 위해서는 모니터링과 경보의 실시간성 처리가 매우 중요할 것 같다.

## 📝 2. 내용 정리
## 2단계: 개략적 설계안 제시 및 동의 구하기
### 지표 모니터링 및 경보 시스템 5가지 컴포넌트
1. 데이터 수집
2. 데이터 전송
3. 데이터 저장소
4. 경보
5. 시각화

### 데이터 모델
- 지표 데이터는 통상 시계열 데이터 형태로 기록
- 데이터 접근 패턴
  - 쓰기 부하 막대
  - 읽기 부하는 일시적으로 증가 후 잠잠
 
### 데이터 저장소 시스템
- 시계열 데이터에 최적화된 DB는 InfluxDB와 프로메테우스이다.
  - 다량의 시계열 데이터를 저장하고 빠른 실시간 분석 지원
  - 메모리 캐시와 디스크 저장소 함께 사용
  - 영속성 요건과 높은 성능 요구사항 만족
 
## 3단계: 상세 설계
### 지표 수집
#### 풀 모델
- 실행 중인 애플리케이션에서 주기적으로 지표 데이터 수집
- 지표 수집기는 etcd나 아파치 주키퍼 같은 서비스 탐색 서비스에서 데이터를 가져올 서비스 목록을 확보한다. SDS는 서비스 엔드포인트 목록에 변화가 생길 때마다 지표 수집기에 통보한다.
- 안전 해시 링을 사용하여 해시 링 구간마다 해당 구간에 속한 서버로부터 생산되는 지표의 수집을 담당하는 수집기 서버를 지정한다. 특정 서버의 지표 데이터는 항상 하나의 수집 서버가 처리함을 보장할 수 있다.

#### 푸시 모델
- 지표 출처에 해당하는 서버가 직접 지표를 수집기에 전송하는 모델
- 모니터링 대상 서버에 통상 수집 에이전트라고 부르는 소프트웨어를 설치한다.
- 에이전트가 위치한 서버 클러스터가 자동 규모 확장이 가능하도록 설정되어 있다면 서버가 동적으로 추가되거나 삭제되는 과정에서 해당 데이터는 소실될 수도 있다.
- 지표 수집기가 밀려드는 지표 데이터를 제때 처리하지 못하는 일을 방지하려면, 지표 수집기 클러스터 자체도 자동 규모 확장이 가능하도록 구성하고 그 앞에 로드밸런서를 둔다.

### 지표 전송 파이프라인의 규모 확장
- 시계열 DB에 장애가 생기면 데이터 손실 발생 가능성 -> 큐
- 데이터 수집 컴포넌트와 처리 컴포넌트 사이에 카프카를 두어 결합도를 낮추고 데이터 손실을 막는다.

### 질의 서비스
- 시각화 또는 경보 시스템에서 접수된 요청을 시계열 DB를 통해 처리하는 역할을 담당
- 클라이언트(시각화 또는 경보 시스템)와 시계열 DB 사이의 결합도를 낮춘다.

### 저장소 계층
- 저장 용량 최적화
  - 데이터 인코딩 및 압축
  - 다운샘플링: 데이터 해상도를 낮춰 저장소 요구량 줄이는 기법
  - 냉동 저장소: 잘 사용되지 않는 비활성 상태 데이터를 보관하는 곳

### 경보 시스템
1. 설정 파일(경보 규칙)을 가져와 캐시 서버에 보관
2. 경보 관리자는 경보 설정 내역을 캐시에서 가져옴
3. 설정된 규칙에 근거하여 경보 관리자는 지정된 시간마다 질의 서비스 호출. 질의 결과가 설정된 임계값을 위반하면 경보 이벤트 생성
   - 경보 필터링, 병합, 중복 제거
   - 접근 제어
   - 재시도
4. 경보 저장소에 모든 경보의 상태를 보관. 적어도 알림이 한 번 이상 전달되도록 보장하는 구실
5. 경보 이벤트 카프카에 전달
6. 경보 소비자는 카프카에서 경보 이벤트 읽음
7. 경보 소비자는 읽은 이벤트를 처리하여 다양한 채널로 알림 전송

### 시각화 시스템
- 상용품을 구입해서 쓰자

## 💡 3. 전부 읽고 난 후기
- 실제 현업에서 사용하는 모니터링 시스템에 대한 이해도가 상승했다.
- 푸시 모델 vs 풀 모델 을 비교하여 어떤 점에서 차이가 나는지 알게 되어서 좋다. 
- 핀포인트는 수집 에이전트를 설치해서 사용하니까 푸시 모델이겠다. (찾아보니 푸시 모델 맞음)

## ❓ 4. 특별히 궁금했던 부분
- 평소 모니터링 시스템을 사용하면서 느낀 점 (좋았던 점, 불편했던 점)
