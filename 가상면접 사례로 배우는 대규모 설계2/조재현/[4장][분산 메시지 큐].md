# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각
- 항상 이야기가 나오는 카프카에 조금 더 가까워져보자...이게 항상 필요한 서비스일까 의문도 들음

## 📝 2. 내용 정리

### 1단계 비즈니스 분석
- 하나의 메세지를 여러 사람들이 수신해야 한다.
- 메세지를 반복 수신해야 한다.
- 오래된 데이터는 삭제될 수 있다.(2주)
- 메시지 전달 방식은 최소 1번(중복 전송 가능) 최대 1번(한 번 보내고 재전달 없음 = 메시지 소실 가능), 정확히 한번(금융 도메인) 설정 가능

### 2단계 개략적 설계
- 토픽에 부하가 많아지면 파티션 사딩을 활용한다. - 파티션을 유지하는 서버는 브로커!
- 소비자 그룹을 나누어서 소비자간 협력할 수 있도록 -> 순서보장 문제가 발생
  - 어떤 소비자 그룹에서 오직 한 소비자만 읽도록 해서 순서 문제를 해결

### 3단계 상세 설계
데이터의 장기보관 & 높은 대역폭
- 회전 디스크(높은 순차탐색, 디스크 기반 자료구조) -> 디스크가 느리다는건 랜덤한 상황일 뿐 순차 탐색의 경우 이득
- 쓰기 우선 로그, 세그먼트 단위로 데이터를 계속 저장만 한다. 비활성 세그먼트는 읽기 요청만 처리한다.
장애 대응
- 라우팅 계층을 만들어 적절한 브로커에게 메세지를 보낸다.
- 브로커는 다른 브로커에게 일정 분량 만큼 사본이 동기화되면 다른 브로커에게 보낸다.
- 일괄 처리량을 늘리면 대역폭은 늘어나지만, 응답 속도가 느려지니 이런 양을 조절해야 한다.
풀 모델
- 메세지 소비 속도 조절 가능 (생산속도를 따라갈 때 까지 기다리거나, 소비자를 늘리거나 일괄 실시간 여부도 결정 가능)
- 공격적 일괄 처리에 더 장점이 있음
- 데이터를 끌어가려고 계속 시도해서 소비자의 컴퓨팅 자원이 낭비될 수도 있음
- 브로커간 정보를 카피하는게 아닌 소비자를 통해서 이를 해결함
주키퍼
- 키 값 형태의 젖아소 (메타데이터 저장소, 상태 저장소, 조정 서비스)
- repl이 잘 됐다면 잘 됐다는 응답을 보낸다.
- 리더와 동기화된 사본 간의 차이를 보고 상태를 도기화 한다.


## 💡 3. 전부 읽고 난 후기
- 정말 한번에읽고 이해가 되지 않는다..
- 

## ❓ 4. 특별히 궁금했던 부분
- 메시지 큐는 도대체 어떤 곳에서 많이 사용될까?
- 풀 모델은 소비자에게 일을 대신 시키는 역할도 하는건가? ㅋㅋ
- 소비자라는 개념이 정확히 어떻게 되는건가?
