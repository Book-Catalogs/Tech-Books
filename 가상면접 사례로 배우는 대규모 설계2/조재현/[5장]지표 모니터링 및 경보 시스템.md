# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각
- 그라파나, 프로메테우스 같은 모니터링 시스템을 두면 충분한게 아닐까?
- 지표 데이터는 별도 서비스로 두고 관리한느게 더 맞지 않을까 하는 생각들..?

## 📝 2. 내용 정리
지표가 잘 되어있어야 시스템의 문제를 파악하고 안정성을 보장하기에 최적의 서비스가 될 수 있을 것 같다. <br>

### 1단계
- 시스템 고객은 회사 내부
- 저수준 (하드웨어 정보와 같은), 고수준(TPS, 프로세스 개수)
- DAU : 1억명, 지표는 1년간 보장, 해상도 낮추기 가능

### 2단계 개략적 설계 제시
#### 요구사항
- 데이터 수집, 전송, 저장, 경보, 시각화
- 특정 시점의 CPU 사용량, 모든 지역의 CPU 부하 평균값
- 쓰기가 압도적, 읽기는 잠시 치솟았다가 낮아지는 형태로 이루어짐

#### DB
- RDBMS 는 부적합 : 쿼리를 작성하기 복잡하고 까다로움, 쓰기가 너무 많아 어려움
- NOSQL : 카산드라나 빅테이블이 사용될 수 있지만, 내부 구조에 대한 이해가 필요함
- InfluxDB 프로메테우스가 적합.

### 3단계 상세 설계
#### 풀 모델 (ex 프로메테우스)
- 지표 수집기가 웹 서버, DB클러스터, 큐 클러스터, 캐시 클러스터를 찔러서 데이터를 가져온다.
- 서버가 수시로 추가 및 삭제되면 대규모 환경에서는 어렵다. 대신 아파치 주키퍼처럼 서비스 탐색 기술을 활용해 문제를 해결
- 지표 수집기는 여러대가 필요해야만 대규모 데이터를 감당 가능. 하지만 각 지표수집기마다 데이터를 중복으로 가져올 수 있음
 중복 해결 -> 해시 링
- 해시 구간마다 서버로부터 생산되는 데이터를 수집함.
- 디버깅이 쉬움, 헬스 체크가 더 쉬움, tcp사용, 데이터 신뢰성이 높음
#### 푸시 모델 (ex 클라우드워치, 그라파이트)
- 웹 서버나 데이터베이스를 서버가 직접 지표를 수집기에 전송한다.
- 데이터 송신 양이 줄어들어서 좋음, 하지만 오토스케일링 과정에서 데이터 소실 가능성이 있음 -> 앞에 로드밸런서를 둬서 해결한다.
- 장애 원인이 네트워크인지 서버인지 모른다, 생명주기가 짧은 경우 푸시모델이 더 낫다. 오트스케일링에 유리, udp사용, 인증체계를 넣어 신뢰성 확보
#### 데이터 집계
1. 수집 에이전트가 집계 : 복잡한 로직은 어렵지만 분단위 집계 가능
2. 데이터 수집 파이프라인 집계 : 계산 결과만 기록하기 때문에 기록양이 줄어든다. 하지만 늦게 도착하는 데이터 처리가 어렵다. 원본 보장 어려움
3. 질의 시에 집계 : 데이터를 날것 그대로 보관, 질의 처리 순간에만 활용하면 되지만 그순간 속도가 느려진다.
- 질의 서비스를 구하기 위한 캐시 계층(부하를 낮추기 위해)
#### 저장소 계층
- 데이터를 인코딩 압축 -> 특정 '초'를 기준으로 그 값의 차이만 저장한다.
- 해상도를 낮춰 저장한다. 7일이내는 1분, 1년은 1시간단위로 저장하는 그런 데이터를 만들어서 활용
- 냉동 저장소 : 데이터를 장기적으로 저장하는 용도

## 💡 3. 전부 읽고 난 후기
- 많은 데이터를 관리하는 방법이 진화했다? 라고 느꼈다. (1분 단위, 1시간 단위, 1달 단위)
- 부하를 줄이기 위한 장치의 기본은 메세지 큐와 캐시는 거의 기본이구나~~~

## ❓ 4. 특별히 궁금했던 부분
- 경보시스템에서 이메일에서 보내고 나서 잘 보냈는지 어떻게 확인할 수 있을까?
  - 최근 신한은행에서 개인정보 동의 확인 이메일이 같은게 3개 도착함. 왜그랬을까? (시스템은 모르지만 유추해보자!)
- 마케팅 서비스 같은 경우 개인정보 동의한 사람들에 한해서 push할텐데, 그러면 이들에 대한 동의 여부를 매번 확인할까..?아니면 관리 DB를 따로 만들까?
  - 이벤트에 데이터를 담는다. Braze라는 서비스가 있음.
- 데이터 이력 저장을 어떻게 하고 있는지?
- 이력은 정말 많이 쌓일텐..? (소실되면 안되는 비즈니스 데이터를 고려해보자면 어떻게 생각할 수 있는지?)