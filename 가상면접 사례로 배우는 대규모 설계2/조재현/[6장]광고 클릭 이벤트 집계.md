# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각
- 광고는 그냥 클릭하면 클릭한 정보를 전송만 하는건 그냥 카프카 같은 걸 두면 되지 않을까?
- 어플리케이션 레벨로 처리하는 그 이상이 필요한걸까? 싶기도..

## 📝 2. 내용 정리
### 1단계
- 서버에 분산된 로그 파일을 추가한다.
- 10억 개의 클릭 이벤트, 2백만 회의 광고 게제, 클릭 이벤트는 매년 30프로 증가
- 엣지케이스 (예상보다 늦게 도착하는 이벤트, 중복, 시스템 복구)

### 2단계
#### 저장 데이터 
- 원시데이터와 집계 데이터를 모두 보관
  - 원시데이터는 재계산, 손실 없이보관, 집계는 용량 절감, 빠른 질의 가능
  - 원시데이터는 기계학습을 위한 목적으로 사용하기도 한다.
로그모니터 -> 데이터 푸시 -> 데이터 집계 -> 광고수 상위광고 통계 -> DB  <- 질의
#### 비동기 처리
- 위 시스템은 데이터를 비동기로 처리한다. 생산자와 소비자의 용량이 다르기 떄문에 어려움
- 카프카를 활용해 극복한다... (또!! 이정도면 공부해야 하나)
- 데이터 푸시, 그리고 DB에 저장될떄 메세지 큐를 넣어 부하를 해결한다.
#### 맵 리듀스
- DAG : 작은 컴퓨팅 단위로 나눠서 사용한다.
- 노드별로 조건을 만족하는지 여부에 따라 분류한다. 이에 따라 집계가 이루어지도록
- 집계 노드 - 리듀스 노드로 나누고 TCP로 통신, 중간 데이터는 메모리에 저장해서 처리

### 3단계
#### 스트리밍 vs 일괄 처리
- 스트림은 데이터를 오는대로 실시간으로 처리, 일괄 처리는 이력을 백업하기 위해 활용한다.
#### 데이터 재계산
- 데이터 재처리 버그 발생시점부터 계산해서 사용하기 위해선 이 내용이 필요하다.
#### 시간
- 이벤트 시간 : 광고 클릭이 발생한 시간, 처리 시각 : 서버가 처리한 시간
- 이벤트 시간은 결과가 부정확할 수 있어서 주의해야함
- 늦은 데이터를 처리하기 위해선 워터마크를 활용(약간 여분의 시간을 더 두어서 다른 구간의 윈도우를 읽기)
#### 집계 윈도우
- 슬라이딩 윈도우 (지난 3분 동안 간격의 크기를 계속 움직여가며 데이터를 걸쳐가며 수집하기)
#### 전달 보장
- 최소 한번, 최대 한번, 정확히 한번 (최소 한번으로 중복을 조금 허용하자)
- 정확히 한번만 처리하기 위해서는 오프셋 값을 S3에 저장하는 과정이 추가되어야 한다. (이 과정이 트랜잭션 안에 포함되어야 함)
  - 그러지 않으면 장애 이후 복구된 과정에서 정보 재처리가 불가능하다.
#### 규모가 커진다면?
- 기본 : 샤딩, 파티션, 해시키 등의 기본적인 방법
- 방법 1 : 해시키마다 별도의 처리 스레드를 두어 해결(상대적으로 쉬운 방법)
- 방법 2 : 자원 공급자에 배포한다. (일반적으로 사용하는 방법)
- 핫스팟 문제 : 자원관리자에게 자원을 요청해 할당받아 이벤트를 분산 처리 한다.
- 결함 내성 : 집계 노드에 장애가 생기면 결과도 손실된다. 그래서 시스템 상태를 스냅숏으로 저장하고 그 지점부터 복구한다.
- 조정 : 데이터를 비교해 데이터 무결성을 보증하는 기법
  - 실시간 집계 결과와 각 파티션에 기록된 클릭 이젠트를 발행 시각에 따라 정렬 및 일괄 처리 결과를 비교
  - 아주 정확하진 않겠지만 유사한 결과를 줄 수 있음

## 💡 3. 전부 읽고 난 후기
- 책을 다 읽고 난 후 느낀 점, 배우게 된 점, 아쉬운 점을 자유롭게 적어주세요.
- 전체적인 평가나 적용하고 싶은 점도 포함될 수 있습니다.

## ❓ 4. 특별히 궁금했던 부분
- 214p, 215p 업스트림 카프카? 다운스트림 카프카?
- 아파치 하둡이란?
- 