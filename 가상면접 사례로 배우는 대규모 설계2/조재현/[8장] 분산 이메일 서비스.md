# 📚 스터디 템플릿

## 📖 1. 목차를 읽기 전에 든 생각
- 되게 레거시한 느낌이 든다.
- 메일을 보내구 수신하고 수신한 사람만 그 메일을 읽어야 할텐데, 이런 것들에 대한 구체적인 기능 설계가 궁금하다?

## 📝 2. 내용 정리
### 1단계
- 10억명이 사용하는 서비스
- 인증, 이메일 발수신, 이메일 가져오기, 필터링, 검색, 스팸 바이러스 방지
- SMTP, POP. IMAP, HTTP를 활용한다고 가정
- 첨부파일 활용해야 함
- 가용성 보장해야함 (데이터 복제)

### 2단계
#### 프로토콜
SMTP : 이메일을 서버에서 다른 서버로 보내는 표준 프로토콜
POP : 이메일을 가져오는 목적으로 활용한다.
IMAP : 원격 메일 서버에서 임에링르 수신하는데 사용되는 다른 프로토콜이다.
HTTPS: 웹기반 이메일 프로토콜 접속에 이용될 수 있음

#### 분산 메일 서버
웹메일 -> HTTPS(웹서버)
      -> 웹소켓(실시간 서버)
메타데이터, 첨부파일 저장소, 분산 캐시, 검색 저장소
- 웹메일로 메일 수발신
- 웹서버 : 로그인, 가입, 사용자 프로파일 기능 담당. (기본적인 이메일 검증)
- 실시간 서버 : 새로운 이메일 내역을 클라이언트에 실시간으로 전달한다.
- 첨부파일 저장소 : S3


### 3단계
#### 메타데이터 DB
- 이메일 헤더는 작고 빈번하게 이용된다.
- 이메일 가져오기, 읽은 메일로 표시, 검색등의 이메일 관련 작업은 사용자별로 격리 수행된다.
- RDBMS는 소규모 검색에서 유리하지만, 규모가 커지면 성능이 좋지 않음
- 사실 완벽히 지원되는 DB는 없을듯 NoSQL로 설계해봄

#### 데이터 모델
- 파티셔닝 : 파티션 키를 User_id로, folder_id도, TIMEUUID도
- 비정규화 : NoSQL의 특성상 질의가 어려움. 그래서 읽음, 읽지 안음 DB를 두 테이블로 분할해서 사용한다.

#### 검색
이메일 전송, 수신, 삭제 떄마다 쓰기가 더 빈번하게 발생하는 작업
- Elastic Search : 검색 최적화 서비스. 메타데이터를 저장하는 곳과 검색엔진용 클러스터를 따로 둬 데이터의 정합성을 잘 생각해야 한다.
- 카프카 : 이런 쓰기 작업이 시작하는 서비스와 실제로 수행하는 서비스의 결합도를 낮춘다.

#### 맞춤형 검색 솔루션
- 디스크 쓰기 작업량이 엄청나기 떄문에 이에 대한 조절이 필요한 상황
- LSM : 0번 캐시부터 임계치에 다다르면 상위 계층으로 병합된다.

#### 시스템 규모 확장
전 세계 국가 단위로도 데이터 센터에 정보를 다중화 해야 하는 설계도 고려해야 하낟.

## 💡 3. 전부 읽고 난 후기
- 이메일 시스템이 그냥 데이터 전송을 주고 받는 방법이라고만 생각했는데, 생각보다 고려해야 하는 내용이 상당히 많다는 것을 느낌
- 우리 회사는 이정도 부분을 고려한 설계가 가능할 까 라는 생각도 들기도.. ㅎ


## ❓ 4. 특별히 궁금했던 부분
- 웹에서도 그럼 웹소켓을 열어두면서 실시간으로 들어오는 메일을 받아서 확인할 수 있는 연결을 계속 유지할까? 이게 과연 좋은 방법일까?
- 생각보다 메일이 전송하고 수신하는 과정까지 시간이 꽤 걸리는 경우도 있는데, (첨부파일이 크지 않더라도) 왜 그럴까? (국내 기준)
- 첨부파일 되는 내용에 대한 보안 검사를 하게 되면 결국 개인 계정에 대한 보안 침해 문제는 없는걸까?